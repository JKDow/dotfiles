---
- name: Show detected OS (for sanity)
  ansible.builtin.debug:
    msg: "Detected distribution: {{ ansible_facts['distribution'] }}"

- name: Install base packages on Arch (per package)
  become: true
  ansible.builtin.pacman:
    name: "{{ item }}"
    state: present
    update_cache: true
  loop: "{{ arch_base_packages }}"
  loop_control:
    label: "{{ item }}"
  when: ansible_facts['distribution'] == 'Archlinux'

- name: Ensure current user has zsh as login shell (if installed)
  become: true
  ansible.builtin.user:
    name: "{{ ansible_facts['user_id'] }}"
    shell: /bin/zsh
  when: ansible_facts['distribution'] == 'Archlinux'

- name: Ensure $HOME config directories exist
  become: false
  ansible.builtin.file:
    path: "{{ lookup('env', 'HOME') }}/{{ item }}"
    state: directory
    mode: '0755'
  loop: "{{ arch_home_directories }}"
  loop_control:
    label: "{{ item }}"
